<% var curLang = '' %>
<% site.pages.find({ type: 'language', language: page.language }).each(function (lang) { %>
  <% curLang = lang %>
<% }) %>

<article class="article article-type-<%= page.layout %>" >
  <div class="article-inner">
    <header class="article-header">
      <h1 class="article-title"><%= page.title %></h1>
      <% if (page.parityVerified && page.parityVerified.length > 0) { %>
        <div style="margin-top: 8px;">
          <% page.parityVerified.forEach(function(verified) { %>
            <span style="display: inline-block; background-color: #4c1; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-right: 6px;">
              ✓ Verified: <%= verified %>
            </span>
          <% }) %>
        </div>
      <% } %>

      <%
      // Rosetta Stone: Find equivalent functions in other languages
      // 1. Exact name matches (same function name across languages)
      // 2. Semantic equivalents from website/source/_data/rosetta.yml
      var rosettaLinks = [];
      var currentPath = page.language + '/' + page.category + '/' + page.function;
      var seenPaths = {};
      seenPaths[currentPath] = true;

      // Helper to add a link if not already seen
      function addLink(path) {
        if (seenPaths[path]) return;
        seenPaths[path] = true;
        var parts = path.split('/');
        if (parts.length === 3) {
          site.pages.find({ type: 'function', language: parts[0], category: parts[1], function: parts[2] }).each(function(fn) {
            rosettaLinks.push({ page: fn, path: path });
          });
        }
      }

      // 1. Find exact name matches
      site.pages.find({ type: 'function', function: page.function }).each(function(fn) {
        if (fn.language !== page.language) {
          addLink(fn.language + '/' + fn.category + '/' + fn.function);
        }
      });

      // 2. Find semantic equivalents from rosetta.yml mappings
      if (site.data && site.data.rosetta) {
        Object.keys(site.data.rosetta).forEach(function(group) {
          var paths = site.data.rosetta[group];
          if (paths && paths.indexOf(currentPath) !== -1) {
            paths.forEach(function(path) {
              addLink(path);
            });
          }
        });
      }

      // Sort by language order for consistent display
      rosettaLinks.sort(function(a, b) {
        var orderA = 99, orderB = 99;
        site.pages.find({ type: 'language', language: a.page.language }).each(function(l) { orderA = l.order || 99; });
        site.pages.find({ type: 'language', language: b.page.language }).each(function(l) { orderB = l.order || 99; });
        if (orderA !== orderB) return orderA - orderB;
        return a.page.function.localeCompare(b.page.function);
      });
      %>
      <% if (rosettaLinks.length > 0) { %>
        <div style="margin-top: 12px; padding: 10px 14px; background: #f8f9fa; border-left: 4px solid #007acc; border-radius: 4px;">
          <span style="font-size: 13px; color: #555;">
            <strong>Rosetta Stone:</strong>
            <% rosettaLinks.forEach(function(link, idx) { %>
              <a href="/<%= link.path %>/" style="margin-left: 8px;" title="<%= link.page.title %>"><%= link.page.language %>/<%= link.page.function %></a><% if (idx < rosettaLinks.length - 1) { %> ·<% } %>
            <% }); %>
          </span>
        </div>
      <% } %>
    </header>

    <div class="article-entry">
      <h2>How to use</h2>
      <p>
        You you can install via <code>yarn add locutus</code> and
        require this function via <code>const <%= page.function %> = require('locutus/<%= page.language %>/<%= page.category %>/<%= page.function %>')</code>.
      </p>
      <p>
        It is important to use a bundler that supports tree-shaking
        so that you only ship the functions that you actually use to your browser,
        instead of all of Locutus, which is massive. Examples are:
        <a href="https://parceljs.org/" target="_blank" rel="external">Parcel</a>,
        <a href="https://webpack.github.io/" target="_blank" rel="external">webpack</a>, or
        <a href="https://rollupjs.org/" target="_blank" rel="external">rollup.js</a>.

        For server-side use this is typically less of a concern.
      </p>

      <% if (page.examples.length > 0 ) { %>
        <h2>Examples</h2>
        <p>
          Please note that these examples are distilled from test cases that automatically verify
          our functions still work correctly. This could explain some quirky ones.
        </p>

        <table>
          <tr><th>#</th><th>code</th><th>expected result</th></tr>
        <%
        var cnt = 0;
        page.examples.forEach(function(example) {
          cnt++
          var ret = page.returns[(cnt - 1)]
          %>
          <tr><td><%= cnt %></td><td><code><%= example %></code></td><td><code><%= ret %></code></td></tr>
        <% }) %>
        </table>
      <% } %>

      <% if (page.language === 'php' && page.category === 'array') { %>
        <h2>PHP arrays and JavaScript</h2>
        <p>
          Please note that Locutus uses JavaScript objects as substitutes for PHP arrays,
          they are the closest we can get to this hashtable-like data structure without
          rolling our own. While many JavaScript implementations preserve the order of object properties, the
          <a href="https://www.ecma-international.org/ecma-262/5.1/#sec-8.6">ECMAScript Language Specification</a>
          explicitly states that:
        </p>

        <blockquote>The mechanics and order of enumerating the properties is not specified.</blockquote>

        <p>
          So don't use this for anything serious if you rely on the order to be consistent accross platforms.
        </p>

        <p>
          To influence how Locutus treats objects to arrays, you can check out the `locutus.objectsAsArrays` setting.
        </p>
      <% } %>

      <% if (page.language === 'ruby') { %>
        <h2>Ruby nil and JavaScript undefined</h2>
        <p>
          Ruby's <code>nil</code> and JavaScript's <code>undefined</code> are semantically equivalent—both
          represent "no value" or "nothing here". However, they serialize differently:
          <code>nil</code> becomes <code>null</code> in JSON, while <code>undefined</code> is typically
          omitted or becomes <code>undefined</code>.
        </p>
        <p>
          Locutus Ruby functions return <code>undefined</code> (idiomatic JavaScript) where Ruby would
          return <code>nil</code>. Our parity tests treat these as equivalent when verifying against
          native Ruby.
        </p>
      <% } %>

      <% if (page.language === 'c') { %>
        <h2>C types and JavaScript</h2>
        <p>
          C is statically typed while JavaScript is dynamically typed. Locutus C functions
          accept JavaScript's flexible types but are only parity-verified for inputs that would
          be valid in C.
        </p>
        <p>
          For example, <code>abs()</code> in JavaScript accepts floats (like C's <code>fabs()</code>)
          and handles strings gracefully, but only integer inputs are verified against native C.
          This pragmatic approach gives you the expected C behavior for valid inputs while
          leveraging JavaScript's flexibility for edge cases.
        </p>
      <% } %>

      <% if (page.notes.length > 0) { %>
        <h2>Notes</h2>
        <ul>
        <% page.notes.forEach(function(note) { %>
          <li><%- markdown(note) %></li>
        <% }) %>
        </ul>
      <% } %>

      <% if (page.dependencies.length > 0) { %><code><%= page.category %></code>
        <h2>Dependencies</h2>

        <ul>
        <% page.dependencies.forEach(function(dependency) { %>
          <li><a href="/functions/<%= dependency %>"><%= dependency %></a></li>
        <% }) %>
        </ul>
      <% } %>

      <p>
        <%- page.description %>
      </p>

      <!-- Code -->
      <%- page.content %>


      <div class="clearfix"></div>

      <h2>A community effort</h2>
      <p>
        Not unlike Wikipedia, Locutus is an ongoing community effort. Our philosophy follows
        <a href="https://medium.com/what-i-learned-building/9216e1c9da7d">The McDonald’s Theory</a>.
        This means that we assimilate first iterations with imperfections,
        hoping for others to take issue with-and improve them.

        This unorthodox approach has worked very well to foster fun and fruitful collaboration,
        but please be reminded to use our creations at your own risk.
        <code>THE SOFTWARE IS PROVIDED "AS IS"</code> has never been more true than for Locutus.
      </p>
      <p>
        Now go and:
        [
        <strong><a href="https://github.com/locutusjs/locutus/blob/main/src/<%= page.language %>/<%= page.category %>/<%= page.function %>.js">View on GitHub</a></strong>
        |
        <strong><a href="https://github.com/locutusjs/locutus/edit/main/src/<%= page.language %>/<%= page.category %>/<%= page.function %>.js">Edit on GitHub</a></strong>
        |
        <strong><a href="https://raw.githubusercontent.com/locutusjs/locutus/main/src/<%= page.language %>/<%= page.category %>/<%= page.function %>.js">View Raw</a></strong>
        ]
      </p>


      <hr />
      <%- partial('locutus/add_more', {curLang: curLang}) %>
      <p>
        <a href="/<%= page.language %>/<%= page.category %>/">&laquo; More <%= curLang.human %> <%= page.category %> functions</a>
      </p>

      <center>
        <br>
        <a class="github-button" href="https://github.com/locutusjs/locutus" data-size="large" data-show-count="true" aria-label="Star locutusjs/locutus on GitHub">Star</a>
        <br>
        <br>
      </center>
    </div>
  </div>
</article>
